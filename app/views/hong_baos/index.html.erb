<%= permission_banner(:camera) %>

<%= render "shared/header" %>
<div class="min-h-screen bg-base-100 flex flex-col gap-10 items-center justify-center p-4">
  <div class="w-full max-w-xl bg-base-200 p-8
              border-4 border-primary outline outline-8 outline-primary
              rounded-2xl shadow-2xl relative">

    <h2 class="text-2xl font-bold text-white text-center mb-6">Scan Hong Bao QR Code</h2>

    <%# Instructions section %>
    <div class="bg-white/90 rounded-xl p-4 mb-4">
      <div class="flex items-center gap-3 text-gray-700">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-success flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z" />
        </svg>
        <div class="text-sm space-y-1">
          <p class="font-semibold">Scan either side of your Hong Bao:</p>
          <ul class="list-disc list-inside ml-2 space-y-0.5">
            <li>Front side to view balance</li>
            <li>Back side to enable transfers</li>
          </ul>
        </div>
      </div>
    </div>

    <%= render QrScannerFormComponent.new(
          url: search_hong_baos_path,
          attribute: "hong_bao[scanned_key]",
          auto_start: true
        ) %>

    <%# Manual input option %>
    <div class="divider">OR</div>

    <div class="bg-white/90 rounded-xl p-4">
      <p class="text-sm font-semibold text-gray-700 mb-3">Enter Bitcoin address manually:</p>
      <%= form_with model: HongBao.new, url: search_hong_baos_path(redirect_to: params[:scan_for_save] ? new_saved_hong_bao_path : nil), local: false, data: { turbo: false }, class: "flex flex-col gap-3" do |f| %>
        <%= f.text_field :scanned_key,
            placeholder: "bc1q...",
            class: "input input-bordered w-full",
            pattern: "^[13][a-km-zA-HJ-NP-Z1-9]{25,34}$|^bc1[a-z0-9]{39,59}$",
            title: "Please enter a valid Bitcoin address" %>
        <%= f.submit "Search Address", class: "btn btn-primary w-full" %>
      <% end %>
    </div>
  </div>

  <%# Help tooltip %>
  <div class="text-sm text-gray-700 bg-white/90 rounded-xl p-4 max-w-md text-center">
    <p class="font-medium">ðŸ’¡ Tip:</p>
    <p>Make sure the QR code is well-lit and centered in the camera view.</p>
  </div>
</div>