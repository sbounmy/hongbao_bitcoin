<div class="min-h-screen bg-[#FFE5E5] flex flex-col items-center justify-center p-4">
  <div class="w-full max-w-md bg-[#F04747] p-8
              border-4 border-[#FFB636] outline outline-8 outline-[#F04747]
              shadow-lg relative">

    <%# Logo and Title %>
    <div class="text-center mb-8">
      <%= image_tag "hongbao-bitcoin-logo-520.png",
          class: "w-16 h-16 mx-auto mb-4 rounded-full border-2 border-[#FFB636]",
          alt: "Bitcoin Hong Bao Logo" %>
      <h1 class="text-2xl font-bold text-[#FFB636]">Bitcoin Hong Bao</h1>
      <p class="text-white/80">Gift Bitcoin printed on a Paper</p>
    </div>


    <%= form_with(model: @hong_bao,
                  class: "space-y-6",
                  data: {
                    controller: "hong-bao",
                    hong_bao_current_step_value: @current_step || 1
                  }) do |form| %>

    <%# Steps Progress %>
    <div class="flex justify-between mb-8">
      <% ["Choose Template", "Print", "Top up"].each_with_index do |step, index| %>
        <div class="flex flex-col items-center">
          <div class="w-8 h-8 rounded-full flex items-center justify-center
                      <%= index + 1 == @current_step ? 'bg-[#FFB636] text-[#F04747]' : 'bg-white/20 text-white' %>"
               data-hong-bao-target="stepIndicator">
            <%= index + 1 %>
          </div>
          <span class="text-xs mt-1 text-white/80"><%= step %></span>
        </div>
        <% if index < 2 %>
          <div class="flex-1 h-0.5 mt-4 <%= index + 1 < @current_step ? 'bg-[#FFB636]' : 'bg-white/20' %>"
               data-hong-bao-target="stepConnector"></div>
        <% end %>
      <% end %>
    </div>

    <% if @hong_bao.errors.any? %>
      <div class="bg-red-500/10 text-red-400 p-4 rounded-lg">
        <ul class="list-disc list-inside">
            <% @hong_bao.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <%# Step 1: Choose Paper %>
      <div data-hong-bao-target="step">
        <%# Template Selection Buttons - Completely separate section %>
        <nav class="flex gap-2 mb-4" data-hong-bao-target="templateButtons">
          <% @papers.each do |paper| %>
            <button type="button"
                    class="px-4 py-2 rounded-lg text-sm
                           <%= paper == @papers.first ? 'bg-[#FFB636] text-[#F04747]' : 'bg-white/20 text-white' %>"
                    data-action="click->hong-bao#switchTemplate"
                    data-paper-id="<%= paper.id %>">
              <%= paper.name %>
            </button>
          <% end %>
        </nav>

        <%# Papers Display Container - Separate section %>
        <div data-hong-bao-target="paperContainer">
          <%= form.hidden_field :paper_id,
              data: { hong_bao_target: "selectedPaper" },
              value: @papers.first.id %>

          <%# Papers Display %>
          <% @papers.each do |paper| %>
            <div data-paper-preview data-paper-id="<%= paper.id %>"
                 class="space-y-4 <%= paper == @papers.first ? '' : 'hidden' %>">
              <div class="grid grid-cols-2 gap-4">
                <div class="border-2 border-[#FFB636] rounded-lg p-2">
                  <%= image_tag paper.image_front, class: "w-full rounded" if paper.image_front.attached? %>
                </div>
                <div class="border-2 border-[#FFB636] rounded-lg p-2">
                  <%= image_tag paper.image_back, class: "w-full rounded" if paper.image_back.attached? %>
                </div>
              </div>

              <%# Mnemonic and Address Display %>
              <% if @hong_bao.mnemonic && @hong_bao.address %>
                <div class="text-white space-y-2">
                  <div class="bg-black/20 p-3 rounded">
                    <p class="text-sm font-mono break-all">
                      <span class="text-white/60">Mnemonic:</span>
                      <%= @hong_bao.mnemonic %>
                    </p>
                  </div>
                  <div class="bg-black/20 p-3 rounded">
                    <p class="text-sm font-mono break-all">
                      <span class="text-white/60">Address:</span>
                      <%= @hong_bao.address %>
                    </p>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>

      <%# Step 2: Instructions %>
      <div data-hong-bao-target="step">
        <div class="text-white space-y-4">
          <h3 class="font-bold">Important Instructions</h3>
          <ul class="list-disc list-inside space-y-2">
            <li>Print this page and keep it in a safe place</li>
            <li>You'll need the recovery phrase to access the funds</li>
            <li>Share the printed hong bao with the recipient</li>
          </ul>
          <%= form.number_field :amount,
              class: "mt-4 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#FFB636] focus:ring focus:ring-[#FFB636] focus:ring-opacity-50",
              placeholder: "Enter amount (1-1000)",
              required: true,
              min: 1,
              max: 1000 %>
        </div>
      </div>

      <%# Step 3: Payment Method %>
      <div data-hong-bao-target="step">
        <div class="grid grid-cols-3 gap-4">
          <% @payment_methods.each do |method| %>
            <label class="cursor-pointer">
              <%= form.radio_button :payment_method_id, method.id,
                  class: "hidden peer" %>
              <div class="border-2 border-transparent peer-checked:border-[#FFB636] rounded-lg p-4 text-center">
                <%= image_tag method.logo, class: "w-12 h-12 mx-auto mb-2" if method.logo.attached? %>
                <span class="text-white text-sm"><%= method.name %></span>
              </div>
            </label>
          <% end %>
        </div>
      </div>

      <%# Navigation Buttons %>
      <div class="flex justify-between space-x-4">
        <% if @current_step != 1 %>
          <button type="button"
                  class="flex-1 py-2 px-4 border border-[#FFB636] rounded-md shadow-sm text-sm font-medium text-[#FFB636] bg-transparent hover:bg-[#FFB636]/10"
                  data-action="hong-bao#previousStep">
            Previous
          </button>
        <% end %>

        <% if @current_step == 3 %>
          <%= form.submit "Create Hong Bao",
              class: "flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-[#F04747] bg-[#FFB636] hover:bg-[#FFB636]/90" %>
        <% else %>
          <button type="button"
                  class="flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-[#F04747] bg-[#FFB636] hover:bg-[#FFB636]/90"
                  data-action="hong-bao#nextStep">
            Next
          </button>
        <% end %>
      </div>
    <% end %>
  </div>
</div>