<div class="flex flex-col h-full max-h-full overflow-hidden"
     data-controller="pdf binding"
     data-pdf-filename-value=""
     data-binding-attribute-value="pdfFilenameValue"
     data-binding-name-value="publicAddressText"
     data-action="bitcoin:changed@window->binding#attribute"
     data-steps-target="content"
     data-steps-index="<%= local_assigns[:index] || 2 %>">


  <div class="space-y-3 p-8" data-controller="dialog-key" data-action="click->dialog-key#backdropClose">
    <%= render AlertComponent.new(icon: 'information-circle', message: 'You can import your own keys, or generate a new random one (default). We do not validate imported keys, so please make sure you know what you are doing', class: 'group-[div[data-bitcoin-custom-wallet-value="true"]]:hidden') %>
    <%= render AlertComponent.new(icon: 'information-circle', message: "You're using custom keys. If you're in an untrusted or unsafe environment (printer, internet, or device), fill in only the public address â€” never the private key & recovery phrase.", class: 'hidden group-[div[data-bitcoin-custom-wallet-value="true"]]:flex') %>

    <%= render TextareaComponent.new(:mnemonic_text, label: 'Recovery Phrase (24 words)', clipboard: true) do |fieldset| %>
      <%= fieldset.with_icon do %>
        <%= heroicon "qr-code", class: "w-5 h-5" %>
      <% end %>
      <%= fieldset.with_badge do %>
        <div class="flex flex-row gap-2 items-center">
          <%= button_tag '#',
                  data: {
                    action: "bitcoin#generate dialog-key#reset dialog-key:accepted@window->bitcoin#customWalletChanged"
                  },
                  id: "bitcoin-generate",
                  class: "text-[#FFB636] p-1.5 hover:text-[#FFB636]/80 transition-colors" do %>
            <%= heroicon "arrow-path", class: "w-5 h-5" %>
          <% end %>
          <%= tag.span("Optional", class: 'badge badge-neutral badge-xs hidden group-[div[data-bitcoin-custom-wallet-value="true"]]:flex') %>
        </div>
      <% end %>
      <%= fieldset.with_input do %>
        <%= text_area_tag :mnemonic_text,
                          "",
                          class: "text-area w-full text-white font-mono text-sm py-2 px-10 rounded border border-white/10 resize-none",
                          data: {
                            clipboard_target: "source",
                            controller: "binding textarea-autogrow",
                            binding_name_value: "mnemonicText",
                            action: "bitcoin:changed@window->binding#value input->bitcoin#mnemonicChanged binding:changed->textarea-autogrow#autogrow keydown->dialog-key#open"
                          } %>
        <p class='label hidden group-[div[data-bitcoin-custom-wallet-value="true"]]:flex'>Hand write it on the paper after printing.</p>
      <% end %>
    <% end %>

    <%= render FieldsetComponent.new(:private_key_text, label: 'Private Key', clipboard: true) do |fieldset| %>
      <%= fieldset.with_icon do %>
        <%= heroicon "key", class: "w-5 h-5" %>
      <% end %>
      <%= fieldset.with_badge do %>
        <%= tag.span("Optional", class: 'badge badge-neutral badge-xs hidden group-[div[data-bitcoin-custom-wallet-value="true"]]:flex') %>
      <% end %>
      <%= fieldset.with_input do %>
          <%= text_field_tag :private_key_text,
                            "",
                            class: "bg-transparent",
                            data: {
                              clipboard_target: "source",
                              controller: "binding",
                              binding_name_value: "privateKeyText",
                              action: "bitcoin:changed@window->binding#value input->bitcoin#privateKeyChanged keydown->dialog-key#open"
                            } %>
      <% end %>
      <%= fieldset.with_note do %>
        <p class='label hidden group-[div[data-bitcoin-custom-wallet-value="true"]]:flex'>Hand write it on the paper after printing.</p>
      <% end %>
    <% end %>

    <div class="space-y-1">
      <dialog class="modal" data-dialog-key-target="dialog">
        <div class="modal-box">
          <p>Using your own key will clear the other keys.</p>
          <p>Are you sure?</p>

          <div class="modal-action">
            <button type="button" class="btn btn-ghost" data-action="dialog-key#close" autofocus>Cancel</button>
            <button type="button" class="btn btn-primary" data-action="dialog-key#accept" autofocus>Accept</button>
          </div>
        </div>
      </dialog>
      <%= render FieldsetComponent.new(:public_address_text, label: 'Public Address', clipboard: true) do |fieldset| %>
        <%= fieldset.with_icon do %>
          <%= heroicon "qr-code", class: "w-5 h-5" %>
        <% end %>
        <%= fieldset.with_input do %>
            <%= text_field_tag :public_address_text,
                              "",
                              class: "",
                              data: {
                                clipboard_target: "source",
                                controller: "binding",
                                binding_name_value: "publicAddressText",
                                action: "bitcoin:changed@window->binding#value input->bitcoin#publicAddressChanged keydown->dialog-key#open"
                              } %>

        <% end %>
      <% end %>
    </div>

    <fieldset class="fieldset">
      <legend class="fieldset-legend text-[#FFB636]">Beneficiary</legend>
      <div class="flex gap-2 text-white">
        <label for="mode">
          <span class="">Beginner</span>
        </label>
        <input type="checkbox" id="mode" class="toggle" data-action="bitcoin#modeChanged" />
        <label for="mode">
          <span class="">Maximalist</span>
        </label>
      </div>
      <p class="label">Beginner : QRCode goes to hongbaob.tc for easy access</p>
    </fieldset>

    <div class="sticky bottom-0 rounded-b-3xl z-30 bg-[#F04747] border-t border-[#FFB636]/20">
      <div class="flex flex-col items-center gap-4 w-full">
        <!-- Download PDF Button -->
        <button type="button"
                class="cursor-pointer w-full py-3 px-4 bg-[#FFB636] rounded-xl shadow-lg text-sm font-medium
                        text-black hover:bg-[#FFB636]/90 transition-colors duration-300 flex items-center justify-center gap-2"
                data-paper-pdf-target="downloadButton"
                data-action="pdf#download">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
          </svg>
          Download PDF
        </button>

        <div class="flex items-center space-x-4 w-full">
          <%= render "hong_baos/new/previous_button" if local_assigns[:index] != 1 %>
          <%= render "hong_baos/new/next_button",
            html_options: {
              disabled: true,
              data_action: "pdf:downloaded@window->disabled#remove"
            } %>
        </div>
      </div>
    </div>
  </div>

</div>