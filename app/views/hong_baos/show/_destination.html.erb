<%# BTCDex Style Destination Entry %>
<div class="bg-base-200 rounded-xl border-2 border-[#FFB636] overflow-hidden"
     data-controller="bitcoin-address form-wallet"
     data-form-wallet-bitcoin-outlet="#bitcoin"
     data-action="bitcoin-address:error->form-wallet#error bitcoin-address:success->form-wallet#success"
     data-bitcoin-address-network-value="<%= Current.network %>">

  <%# Header %>
  <div class="bg-[#FFB636] px-4 py-2">
    <h3 class="font-bold text-neutral">Enter Destination</h3>
  </div>

  <div class="p-4 space-y-4">
    <%# Address Input %>
    <div class="relative">
      <%= form.text_field :to_address,
          class: "w-full bg-base-300 text-white border-2 border-transparent
                  focus:border-[#FFB636] rounded-lg py-3 px-4 pr-12
                  placeholder-white/50 focus:outline-none",
          placeholder: "Enter Bitcoin address",
          data: {
            action: "input->bitcoin-address#validate",
            bitcoin_address_target: "input",
            form_wallet_target: "destination"
          } %>

      <button type="button"
              data-action="click->steps#scanQR"
              class="absolute right-3 top-1/2 -translate-y-1/2 text-white/60 hover:text-[#FFB636]
                    transition-colors">
        <%= heroicon "qr-code", variant: :outline, class: "w-6 h-6" %>
      </button>

      <div data-bitcoin-address-target="errorMessage"
           class="text-red-400 text-xs mt-1 hidden">
        Please enter a valid Bitcoin address.
      </div>
    </div>

    <%# Fee Selection %>
    <div class="space-y-2">
      <span class="text-white/60 text-sm">Network Fee</span>
      <div class="grid grid-cols-3 gap-2">
        <% TransactionFee.current.priority_options.each do |option| %>
          <label class="cursor-pointer">
            <%= form.radio_button :fee_rate,
                option[:satoshis],
                class: "hidden peer",
                checked: option[:default],
                data: {
                  form_wallet_target: "fee"
                } %>
            <div class="p-3 bg-base-300 rounded-lg border-2 border-transparent
                        peer-checked:border-[#FFB636] peer-checked:bg-base-300/80
                        hover:bg-base-300/80 transition-colors text-white">
              <div class="text-center space-y-1">
                <span class="font-medium text-sm block"><%= option[:name] %></span>
                <span class="text-xs text-white/60 block">
                  ~<%= time_ago_in_words(option[:minutes].minutes.ago,
                      scope: 'datetime.distance_in_words.short') %>
                </span>
                <div class="text-xs text-[#FFB636]">
                  $<%= number_with_precision(option[:amount] * Spot.current(:usd).usd, precision: 2) %>
                </div>
              </div>
            </div>
          </label>
        <% end %>
      </div>
    </div>

    <%# UTXOs Section %>
    <%= render ContentLoaderComponent.new(url: utxos_hong_bao_path(@hong_bao.address, testnet: Current.testnet?), lazy_loading: true) %>

    <%# Action Buttons %>
    <div class="flex gap-2 pt-2">
      <%= render "hong_baos/new/previous_button" %>

      <%= button_tag class: "flex-1 bg-[#FFB636] text-neutral py-2 px-4 rounded-lg font-semibold text-sm
                            hover:bg-[#FFB636]/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed
                            flex items-center justify-center gap-2",
          data: {
            action: "form-wallet#transfer",
            form_wallet_target: "submitButton"
          } do %>
        <%= heroicon "paper-airplane", class: "w-4 h-4" %>
        <span>Transfer</span>
      <% end %>
    </div>
  </div>
</div>
