<div class="space-y-6">

  <%# Top Card - My Hong Bao with envelope image %>
  <div class="bg-[#F04747] backdrop-blur-lg rounded-3xl shadow-2xl border-4 border-[#FFB636] outline outline-8 outline-[#F04747] p-8 relative overflow-hidden flex">
    <!-- Content Container -->
    <div class="relative z-10 space-y-6">
      <!-- Header and Amount -->
      <div>
        <h2 class="text-white/60 text-xs uppercase tracking-wider mb-2">My Hong Bao</h2>
        <% if false #hide for now %>
          <% performance_data = HongBaoPerformanceService.new(@hong_bao).call %>
          <% metadata = performance_data[:metadata] %>

          <div class="flex items-baseline gap-3 mb-2">
            <div class="text-5xl font-bold text-[#FFB636]">
              $<%= number_with_delimiter((@hong_bao.balance.usd || 0).round(2)) %>
            </div>
            <div class="text-xl font-semibold <%= metadata[:gain_loss_percent] >= 0 ? 'text-green-400' : 'text-red-400' %>">
              <%= metadata[:gain_loss_percent] >= 0 ? '+' : '' %><%= number_to_percentage(metadata[:gain_loss_percent], precision: 1) %>
            </div>
          </div>

          <!-- Bitcoin Amount -->
          <div class="flex items-center gap-2 mb-3">
            <%= image_tag "bitcoin-64x64.svg", class: "w-5 h-5" %>
            <span class="text-white/90 font-mono text-lg">
              ₿<%= number_with_precision(@hong_bao.balance.btc, precision: 8, strip_insignificant_zeros: true) %>
            </span>
          </div>

          <!-- Compact Info: Gifted Date • Address -->
          <div class="flex items-center gap-1 text-white/70 text-sm">
            <span><%= metadata[:gifted_date].strftime("%d %b '%y") %></span>
            <span class="text-white/40">•</span>
            <%= link_to "#{@hong_bao.address[0..5]}...#{@hong_bao.address[-6..-1]}", mempool_url(@hong_bao.address), class: 'link-hover font-mono text-xs', target: "_blank" %>
            <button class="p-1 hover:bg-white/10 rounded transition-colors"
                    data-controller="clipboard"
                    data-clipboard-success-content-value="Copied!"
                    data-action="clipboard#copy">
              <input type="hidden"
                     data-clipboard-target="source"
                     value="<%= @hong_bao.address %>">
              <%= heroicon "clipboard", variant: :outline, class: "w-4 h-4 text-white/60" %>
            </button>
          </div>
        <% else %>
          <!-- Skeleton loading state -->
          <div class="skeleton h-12 w-48 mb-3 bg-white/20"></div>
          <div class="skeleton h-4 w-32 bg-white/20"></div>
        <% end %>
      </div>
    </div>

    <!-- Red envelope image - Decorative background -->
    <div class="">
      <div class="absolute -right-6 -bottom-15 w-68 h-68 -rotate-x-20 rotate-y-15 pointer-events-none">
        <%= image_tag "index/red_front.jpg",
            class: "w-full h-full object-contain",
            alt: "Hong Bao Envelope" %>
      </div>
      <div class="absolute right-4 -bottom-20 w-68 h-68 -rotate-x-20 rotate-y-15 pointer-events-none">
        <%= image_tag "index/red_front.jpg",
            class: "w-full h-full object-contain",
            alt: "Hong Bao Envelope" %>
      </div>

    </div>
  </div>

  <%# Action Buttons %>
  <div class="flex gap-3">
    <!-- Withdraw Button -->
    <button type="button"
            class="flex-1 py-3 px-6 border-2 border-transparent rounded-xl shadow-lg text-base font-medium text-[#F04747] bg-[#FFB636] hover:bg-[#FFB636]/90 transition-colors duration-300 disabled:opacity-30"
            data-controller="disabled"
            data-form-target="submitButton"
            data-action="steps#next"
            <%= 'disabled' if @hong_bao.balance&.btc&.zero? %>>
      Withdraw
    </button>

    <!-- Share Button with Custom Clipboard -->
    <button class="flex-1 py-3 px-6 border-2 border-transparent rounded-xl shadow-lg text-base font-medium text-[#F04747] bg-[#FFB636] hover:bg-[#FFB636]/90 transition-colors duration-300"
            data-controller="clipboard"
            data-clipboard-success-content-value="Link Copied!"
            data-action="clipboard#copy">
      <input type="hidden"
             data-clipboard-target="source"
             value="<%= hong_bao_url(@hong_bao.address) %>">
      <%= heroicon "arrow-up-on-square", class: "w-4 h-4 inline" %>
      <span data-clipboard-target="button">Share</span>
    </button>

    <!-- Refresh Button -->
    <button onclick="window.location.reload()"
            class="flex-1 py-3 px-6 border-2 border-transparent rounded-xl shadow-lg text-base font-medium text-[#F04747] bg-[#FFB636] hover:bg-[#FFB636]/90 transition-colors duration-300">
      <%= heroicon "arrow-path", class: "w-4 h-4 inline" %>
      Refresh
    </button>
  </div>

  <%# Performance Chart Card - Hidden %>
  <% if false %>
  <div class="bg-[#F04747] backdrop-blur-lg rounded-3xl shadow-2xl border-4 border-[#FFB636] outline outline-8 outline-[#F04747] p-6">
    <div class="mb-4">
      <h3 class="text-white font-semibold text-lg">Performance</h3>
      <div class="text-white/60 text-xs">Value since gifted</div>
    </div>

    <% if @hong_bao.balance %>
      <%= render Charts::HongBaoPerformanceComponent.new(hong_bao: @hong_bao) %>
    <% else %>
      <!-- Skeleton loading state -->
      <div class="space-y-2">
        <div class="skeleton h-64 w-full bg-white/20"></div>
        <div class="skeleton h-4 w-full bg-white/20"></div>
      </div>
    <% end %>
  </div>
  <% end %>

  <%# Transaction History %>
  <div class="bg-[#F04747] backdrop-blur-lg rounded-3xl shadow-2xl border-4 border-[#FFB636] outline outline-8 outline-[#F04747] p-6">
    <!-- Header -->
    <div class="p-4 border-b border-white/20">
      <h3 class="text-white font-semibold">Transaction History</h3>
    </div>

    <!-- Content -->
    <div>
      <% if @hong_bao.balance&.transactions&.any? %>
        <% @hong_bao.balance.transactions.each do |tx| %>
          <div class="p-4 border-b border-white/10 last:border-b-0 hover:bg-white/5 transition-colors">
            <div class="flex items-center justify-between">
              <!-- Left side -->
              <div class="flex items-center gap-3">
                <!-- Icon -->
                <div class="w-10 h-10 rounded-full <%= tx.deposit? ? 'bg-green-500/20' : 'bg-white/10' %> flex items-center justify-center">
                  <% if tx.deposit? %>
                    <%= heroicon "arrow-down", variant: "solid", class: "h-5 w-5 text-green-400" %>
                  <% else %>
                    <%= heroicon "arrow-up", variant: "solid", class: "h-5 w-5 text-white" %>
                  <% end %>
                </div>

                <!-- Details -->
                <div>
                  <div class="text-white/90 text-sm font-medium flex items-center gap-2">
                    <% if tx.deposit? %>
                      From: <%= link_to hong_bao_path(tx.from_address), target: "_blank", rel: "noopener noreferrer", class: "hover:text-[#FFB636] transition-colors flex items-center gap-1"  do %>
                      <span><%= tx.pretty_from_address %></span>
                      <%= heroicon "arrow-top-right-on-square", class: "h-3 w-3" %>
                      <% end %>
                    <% else %>
                      To: <%= link_to hong_bao_path(tx.to_address), target: "_blank", rel: "noopener noreferrer", class: "hover:text-[#FFB636] transition-colors flex items-center gap-1"  do %>
                      <span><%= tx.pretty_to_address %></span>
                      <%= heroicon "arrow-top-right-on-square", class: "h-3 w-3" %>
                      <% end %>
                    <% end %>
                  </div>
                  <div class="text-white/60 text-xs">
                    <% if tx.timestamp %>
                      <%= tx.timestamp.strftime("%B %d, %Y at %H:%M") %>
                    <% else %>
                      <span class="inline-flex items-center gap-1">
                        <%= heroicon "arrow-path", variant: "mini", class: "animate-spin h-3 w-3" %>
                        Pending confirmation
                      </span>
                    <% end %>
                  </div>
                </div>
              </div>

              <!-- Right side - Amount -->
              <div class="text-right">
                <div class="<%= tx.deposit? ? 'text-green-400' : 'text-white' %> font-mono text-sm font-medium">
                  <%= tx.deposit? ? '+' : '-' %>₿<%= number_with_precision(tx.btc.abs, precision: 8, strip_insignificant_zeros: true) %>
                </div>
                <div class="text-white/60 text-xs">
                  (<%= number_to_currency(tx.usd.abs, precision: 2) %>)
                </div>
              </div>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="p-8 text-center text-white/60">
          <% if @hong_bao.balance %>
            No transactions found
          <% else %>
            <div class="space-y-2">
              <div class="skeleton h-4 w-32 mx-auto bg-white/20"></div>
              <div class="skeleton h-4 w-24 mx-auto bg-white/20"></div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Hidden next button for withdraw flow -->
  <div class="hidden">
    <%= render "hong_baos/new/next_button", html_options: { disabled: @hong_bao.balance&.btc&.zero? } %>
  </div>
</div>