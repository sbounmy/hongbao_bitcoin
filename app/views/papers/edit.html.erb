<!-- Suppress dock bar on this page -->
<% content_for(:footer) do %>
  <!-- No dock bar on paper editing -->
<% end %>

<%= render MobileHeaderComponent.new(title: "Choose Theme", back_path: new_paper_path) %>

<div class="relative flex flex-col h-[calc(100vh-3.5rem)] md:h-screen md:flex-row">
  <!-- Mobile: Full height minus header, Desktop: Full height -->

  <!-- Paper Preview -->
  <div class="flex-1 bg-base-200 flex items-center justify-center p-4 overflow-hidden">
    <%= turbo_frame_tag @paper do %>
      <% if @paper.processing? %>
        <!-- Show processing state -->
        <div class="flex flex-col items-center gap-4">
          <div class="loading loading-spinner loading-lg"></div>
          <p class="text-base-content/70">Generating your paper...</p>
        </div>
      <% else %>
        <!-- Show paper -->
        <div class="relative max-w-full max-h-full">
          <% if @paper.image_front.attached? %>
            <%= image_tag @paper.image_front,
                class: "max-w-full max-h-[70vh] md:max-h-full object-contain rounded-lg shadow-2xl" %>
          <% else %>
            <div class="w-96 h-96 bg-base-300 rounded-lg flex items-center justify-center">
              <span class="text-base-content/50">No image available</span>
            </div>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </div>

  <!-- Theme Selector (bottom on mobile, right on desktop) -->
  <% unless @paper.processing? %>
    <div class="border-t md:border-t-0 md:border-l bg-base-100 md:w-96">
      <div class="p-4">
        <h3 class="font-bold text-lg mb-4">Choose Theme</h3>

        <%= render 'theme_switcher', paper: @paper %>
      </div>

      <!-- Actions -->
      <div class="p-4 border-t">
        <div class="flex flex-col gap-2">
          <%= link_to "Finalize Paper", paper_path(@paper),
              class: "btn btn-primary w-full",
              data: { turbo: false } %>
        </div>
      </div>
    </div>
  <% end %>
</div>