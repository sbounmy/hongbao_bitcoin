<% content_for :skip_analytics, true %>

<% content_for :head do %>
  <meta name="robots" content="noindex, follow">
<% end %>

<% content_for :footer do %>
  <span class="text-white"></span>
<% end %>

<%= content_for :og_image, rails_blob_url(@paper.image_front, only_path: false) if @paper.image_front.attached? %>
<%= content_for :title, @paper.name if @paper.name.present? %>

<% attributes_for(:screen_attributes, {
  data: {
    controller: 'steps bitcoin pdf',
    steps_current_value: @current_step.to_s,
    steps_hidden_class: 'hidden',
    bitcoin_auto_generate_value: 'true',
    bitcoin_network_value: Current.network.to_s,
    bitcoin_custom_wallet_value: 'false',
    bitcoin_hongbao_logo_value: asset_to_base64('hongbao-bitcoin.png'),
    bitcoin_bitcoin_logo_value: asset_to_base64('bitcoin-64x64.svg'),
    pdf_filename_value: ''
  }
}) %>

<% content_for(:screen_header) do %>
  <%= render "papers/show/headers/step1", paper: @paper, current_step: @current_step %>
  <%= render "papers/show/headers/step2", paper: @paper, current_step: @current_step %>
  <%= render "papers/show/headers/step3", paper: @paper, current_step: @current_step %>
  <%= render "papers/show/headers/step4", paper: @paper, current_step: @current_step %>
<% end %>

<%= turbo_frame_tag "qr_scanner" %>

<%# PDF Preview %>
<div class="min-h-[50vh]">
  <%= render "papers/preview_pdf", paper: @paper %>
</div>

<%# Step content - sticky within screen container %>
<div class="sticky bottom-0 bg-base-100 border-t border-base-300 shadow-[0_-4px_20px_rgba(0,0,0,0.15)] rounded-b-2xl -mx-3 -mb-3 z-10">
  <div class="p-4 max-w-3xl mx-auto max-h-[45vh] overflow-auto">
    <%= render "shared/error_messages", resource: @hong_bao if @hong_bao.errors.any? %>

    <%= render "hong_baos/new/steps/intro",
        index: 1,
        paper: @paper %>

    <%= render "hong_baos/new/steps/print",
        index: 2,
        paper: @paper %>

    <%= render "hong_baos/new/steps/beneficiary",
        index: 3,
        paper: @paper %>

    <%= render "hong_baos/new/steps/top_up",
        index: 4,
        hong_bao: @hong_bao,
        payment_methods: @payment_methods %>
  </div>
</div>
