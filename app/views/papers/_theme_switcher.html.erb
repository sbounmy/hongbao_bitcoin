<%# Theme switcher - horizontal scroll with portrait cards %>
<div class="relative h-48">
  <div class="absolute inset-0 overflow-x-auto overflow-y-hidden">
    <div class="flex gap-3 pb-2 h-full items-start">
    <% Input::Theme.by_position.each do |theme| %>
      <% is_current = paper.theme == theme %>

      <%= form_with url: paper_path(paper),
          method: :patch,
          authenticity_token: false,
          data: { turbo: true, controller: "auto-submit", auto_submit_delay_value: 0 },
          class: "flex-shrink-0" do |f| %>

        <%= f.hidden_field "paper[input_item_theme_attributes][id]", value: paper.input_item_theme&.id %>

        <label class="w-24 cursor-pointer group block">
          <%= f.radio_button "paper[input_item_theme_attributes][input_id]",
              theme.id,
              checked: is_current,
              class: "peer sr-only",
              data: { action: "change->auto-submit#submit" } %>

          <div class="relative rounded-xl border-2 overflow-hidden transition-all
                      border-base-300
                      peer-checked:border-primary peer-checked:ring-2 peer-checked:ring-primary
                      group-hover:border-primary/50">
            <%# Portrait image container %>
            <div class="aspect-[3/4] bg-base-200">
              <% if theme.image.attached? %>
                <%= image_tag theme.image, class: "w-full h-full object-cover", loading: "lazy" %>
              <% else %>
                <div class="w-full h-full flex items-center justify-center text-base-content/30">
                  <%= heroicon "photo", class: "w-6 h-6" %>
                </div>
              <% end %>
            </div>

            <%# Check indicator - shown via peer-checked %>
            <div class="absolute bottom-2 right-2 w-5 h-5 rounded-full bg-primary text-primary-content
                        flex items-center justify-center opacity-0 peer-checked:opacity-100 transition-opacity">
              <%= heroicon "check", variant: :mini, class: "w-3 h-3" %>
            </div>
          </div>

          <%# Theme name %>
          <p class="mt-2 text-xs font-medium text-center truncate text-base-content/70
                    peer-checked:text-primary transition-colors">
            <%= theme.name %>
          </p>
        </label>
      <% end %>
    <% end %>
    </div>
  </div>
</div>
