<%#
  Paper canvas with portrait compositing support.
  Extends the standard paper_canva with portrait position values for client-side compositing.
%>
<%
  # Get canvas dimensions from frame
  frame = local_assigns[:frame] || Frame.new
  dimensions = frame.canvas_dimensions
  strict = local_assigns[:strict] || false
  portrait_config = local_assigns[:portrait_config] || {}
%>
<div data-controller="canva"
     data-canva-width-value="<%= dimensions[:width] %>"
     data-canva-height-value="<%= dimensions[:height] %>"
     data-canva-strict-value="<%= strict %>"
     data-action="bitcoin:changed@window->canva#redraw canva:imageLoaded->bitcoin#dispatchWalletChanged"
     class="w-full h-full">
  <%= image_tag image_base64, class: "hidden", data: { canva_target: "backgroundImage" } %>
  <canvas data-canva-target="container" class="w-full h-full"></canvas>

  <%# Portrait canva item - handles direct selection and AI generation %>
  <% if portrait_config['x'].present? && portrait_config['x'].to_i > 0 %>
    <div data-controller="portrait-item"
         data-canva-target="canvaItem"
         data-portrait-item-x-value="<%= portrait_config['x'] %>"
         data-portrait-item-y-value="<%= portrait_config['y'] %>"
         data-portrait-item-width-value="<%= portrait_config['width'] %>"
         data-portrait-item-height-value="<%= portrait_config['height'] %>"
         data-action="preview:selected@window->portrait-item#handleSelected portrait:loading@window->portrait-item#handleLoading portrait:changed@window->portrait-item#handleChanged"
         class="hidden canva-item">
    </div>
  <% end %>

  <% elements.each do |name, item| %>
    <%= render 'hong_baos/new/steps/design/canva_item', name:, item: %>
  <% end %>
</div>
