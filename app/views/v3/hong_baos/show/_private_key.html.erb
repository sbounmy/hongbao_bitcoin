<%# Pokedex Style Private Key Verification %>
<div class="bg-base-200 rounded-xl border-2 border-[#FFB636] overflow-hidden"
     data-controller="tabs form-wallet"
     data-tabs-active-class="bg-[#FFB636] text-neutral"
     data-tabs-default-tab-value="private-key"
     data-form-wallet-bitcoin-outlet="#bitcoin"
     data-form-wallet-bitcoin-mnemonic-outlet="#bitcoin-mnemonic"
     data-action="bitcoin-mnemonic:error->form-wallet#error bitcoin-mnemonic:success->form-wallet#successMnemonic">

  <%# Header %>
  <div class="bg-[#FFB636] px-4 py-2">
    <h3 class="font-bold text-neutral">Verify Ownership</h3>
  </div>

  <div class="p-4 space-y-4">
    <%# Tab Buttons %>
    <div class="grid grid-cols-2 gap-2">
      <button type="button"
              data-tabs-target="btn"
              data-tab-id="private-key"
              data-action="tabs#select"
              class="py-2 px-3 rounded-lg font-medium text-sm bg-base-300 text-white
                     hover:bg-base-300/80 transition-colors">
        Private Key
      </button>
      <button type="button"
              data-tabs-target="btn"
              data-tab-id="mnemonic"
              data-action="tabs#select"
              class="py-2 px-3 rounded-lg font-medium text-sm bg-base-300 text-white
                     hover:bg-base-300/80 transition-colors">
        24 Words
      </button>
    </div>

    <% key_controller = @hong_bao.address.start_with?('1', 'm', 'n') ? 'bitcoin-legacy-key' : 'bitcoin-segwit-key' %>

    <%# Private Key Tab %>
    <div data-tabs-target="tab"
         data-tab-id="private-key"
         data-controller="qr-scanner <%= key_controller %>"
         data-<%= key_controller %>-network-value="<%= Current.network %>"
         data-<%= key_controller %>-address-value="<%= @hong_bao.address %>"
         class="space-y-3">

      <%# Camera Button %>
      <button type="button"
              data-action="qr-scanner#startScanning"
              class="w-full py-6 bg-base-300 rounded-lg flex flex-col items-center justify-center gap-2
                     hover:bg-base-300/80 transition-colors border border-white/10">
        <%= heroicon "camera", variant: :outline, class: "w-8 h-8 text-[#FFB636]" %>
        <span class="text-white/70 text-sm">Scan QR Code</span>
      </button>

      <div id="qr-reader" class="hidden w-full bg-base-300 rounded-lg overflow-hidden"></div>

      <div class="relative">
        <%= form.text_field :private_key,
            class: "w-full bg-base-300 text-white border-2 border-transparent
                    focus:border-[#FFB636] rounded-lg py-2 px-3 text-sm
                    placeholder-white/50 focus:outline-none",
            placeholder: "Enter private key",
            data: {
              form_wallet_target: "privateKey",
              qr_scanner_target: "scanValue",
              action: "input->#{key_controller}#validate"
            } %>
        <div data-<%= key_controller %>-target="errorMessage"
             class="text-red-400 text-xs mt-1 hidden">
          Please enter a valid private key.
        </div>
      </div>
    </div>

    <%# Mnemonic Tab %>
    <div data-tabs-target="tab"
         id="bitcoin-mnemonic"
         data-tab-id="mnemonic"
         data-controller="bitcoin-mnemonic"
         data-action="word:fill->bitcoin-mnemonic#fill bitcoin-mnemonic:initialized->bitcoin#new"
         data-bitcoin-mnemonic-address-value="<%= @hong_bao.address %>"
         class="hidden bitcoin-mnemonic"
         data-bitcoin-mnemonic-word-outlet=".word">
      <div class="grid grid-cols-3 md:grid-cols-4 gap-1.5">
        <% 24.times do |i| %>
          <div id="hong_bao_mnemonic_<%= i %>"
               class="relative word"
               data-controller="word"
               data-word-valid-class="border-green-500"
               data-word-invalid-class="border-red-500"
               data-word-bitcoin-mnemonic-outlet=".bitcoin-mnemonic">
            <span class="absolute left-1.5 top-1/2 -translate-y-1/2 text-white/40 text-xs">
              <%= i + 1 %>.
            </span>
            <input type="text"
                   tabindex="<%= i %>"
                   data-word-target="input"
                   data-action="input->word#validateWord paste->word#fill"
                   class="w-full bg-base-300 text-white border border-transparent
                          focus:border-[#FFB636] rounded py-1.5 pl-6 pr-6 text-xs
                          placeholder-white/30 focus:outline-none"
                   placeholder="word">
            <div data-word-target="validIcon"
                 class="validation-icon absolute right-1 top-1/2 -translate-y-1/2 hidden">
              <%= heroicon "check-circle", variant: :mini, class: "w-4 h-4 text-green-500" %>
            </div>
            <div data-word-target="errorIcon"
                 class="validation-icon absolute right-1 top-1/2 -translate-y-1/2 hidden">
              <%= heroicon "exclamation-triangle", variant: :mini, class: "w-4 h-4 text-yellow-500" %>
            </div>
          </div>
        <% end %>
      </div>
      <div data-bitcoin-mnemonic-target="errorMessage"
           class="text-red-400 text-xs mt-2 hidden">
        Please enter a valid 24-word mnemonic phrase.
      </div>
    </div>

    <%# Action Buttons %>
    <div class="flex gap-2 pt-2">
      <%= render "hong_baos/new/previous_button" %>

      <button type="button"
              data-controller="disabled"
              data-action="bitcoin-mnemonic:valid@window->disabled#remove bitcoin-mnemonic:invalid@window->disabled#add steps#next form-wallet#import <%= key_controller %>:valid@window->disabled#remove <%= key_controller %>:invalid@window->disabled#add"
              class="flex-1 bg-[#FFB636] text-neutral py-2 px-4 rounded-lg font-semibold text-sm
                     hover:bg-[#FFB636]/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              disabled>
        Continue
      </button>
    </div>
  </div>
</div>
