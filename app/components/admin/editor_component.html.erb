<div data-controller="editor"
     data-editor-design-value="<%= elements_json %>"
     class="canvas-editor-container border rounded-lg p-4 bg-base-200">

  <% if !image_front.attached? && !image_back.attached? %>
    <div class="text-center p-10 bg-gray-100 rounded">
      <p>Please attach Front and Back images to use the canvas editor.</p>
    </div>
  <% else %>
    <%# Toolbar %>
    <div class="flex items-center gap-2 mb-4">
      <button type="button"
              class="btn btn-sm btn-outline gap-1"
              data-action="click->editor#addText">
        <%= heroicon "plus", variant: :mini, class: "w-4 h-4" %>
        Add Text
      </button>
    </div>

    <%# DOM Container - Elements rendered as HTML/CSS %>
    <div class="<%= frame.portrait? ? 'flex flex-row gap-6 items-start justify-center' : 'flex flex-col gap-6 items-center' %>"
         style="min-height: 400px;">

      <%# Front Container %>
      <% if image_front.attached? %>
        <div data-editor-target="frontWrapper"
             class="shrink-0 rounded-lg shadow-xl overflow-hidden relative bg-gray-300"
             style="<%= frame.portrait? ? 'height: 500px;' : 'width: 100%; max-width: 600px;' %> aspect-ratio: <%= frame.aspect_ratio %>;"
             data-side="front">
          <img src="<%= front_image_url %>"
               class="hidden"
               crossorigin="anonymous"
               data-editor-target="frontBackground" />
          <div data-editor-target="frontContainer"
               class="w-full h-full cursor-default"
               style="container-type: inline-size;"></div>
          <div class="absolute top-2 left-2 bg-black/50 text-white text-xs px-2 py-1 rounded pointer-events-none z-50">Front</div>
        </div>
      <% end %>

      <%# Back Container %>
      <% if image_back.attached? %>
        <div data-editor-target="backWrapper"
             class="shrink-0 rounded-lg shadow-xl overflow-hidden relative bg-gray-300"
             style="<%= frame.portrait? ? 'height: 500px;' : 'width: 100%; max-width: 600px;' %> aspect-ratio: <%= frame.aspect_ratio %>;"
             data-side="back">
          <img src="<%= back_image_url %>"
               class="hidden"
               crossorigin="anonymous"
               data-editor-target="backBackground" />
          <div data-editor-target="backContainer"
               class="w-full h-full cursor-default"
               style="container-type: inline-size;"></div>
          <div class="absolute top-2 left-2 bg-black/50 text-white text-xs px-2 py-1 rounded pointer-events-none z-50">Back</div>
        </div>
      <% end %>
    </div>

    <%# Hidden field for elements JSON %>
    <input type="hidden"
           name="<%= input_base_name %>"
           data-editor-target="field"
           value="<%= elements_json %>" />

    <%# Sample wallet data for placeholder visualization %>
    <input type="hidden"
           data-editor-target="dataSource"
           value="<%= sample_wallet_data %>" />

    <%# Instructions %>
    <div class="mt-4 text-sm text-gray-600">
      <p><strong>Instructions:</strong> Click elements to select, drag to move, use handles to resize. Changes are saved automatically.</p>
    </div>

    <%# Text Drawer - opened programmatically via editor %>
    <div data-controller="editor--text"
         data-action="editor:drawerOpen@window->editor--text#open">
      <dialog id="text-drawer" class="modal">
        <div class="modal-box">
          <h3 class="font-bold text-lg mb-4">Edit Text</h3>

          <%# Render shared text drawer partial %>
          <%= render "papers/new/drawers/text" %>

          <div class="modal-action">
            <button type="button"
                    class="btn btn-error btn-outline btn-sm"
                    data-action="click->editor--text#delete"
                    data-editor--text-target="deleteBtn">
              Delete
            </button>
            <button type="button"
                    class="btn btn-primary btn-sm"
                    data-action="click->editor--text#close">
              Done
            </button>
          </div>
        </div>
        <div class="modal-backdrop">
          <button type="button" data-action="click->editor--text#close">close</button>
        </div>
      </dialog>
    </div>
  <% end %>
</div>
