<% if view_type == :table %>
  <tr id="saved_hong_bao_<%= saved_hong_bao.id %>">
    <% if loading? %>
      <!-- Loading skeleton state -->
      <td>
        <div class="skeleton h-4 w-20"></div>
      </td>
      <td>
        <div class="flex items-center gap-3">
          <div class="avatar placeholder">
            <div class="bg-neutral text-neutral-content rounded-full w-12">
              <span class="text-xl"><%= saved_hong_bao.name[0].upcase %></span>
            </div>
          </div>
          <div>
            <div class="font-bold"><%= saved_hong_bao.name %></div>
            <% if saved_hong_bao.notes.present? %>
              <div class="text-sm opacity-50"><%= truncate(saved_hong_bao.notes, length: 50) %></div>
            <% end %>
          </div>
        </div>
      </td>
      <td>
        <div class="font-mono text-xs" title="<%= saved_hong_bao.address %>">
          <%= saved_hong_bao.address.first(8) %>...<%= saved_hong_bao.address.last(6) %>
        </div>
      </td>
      <td>
        <div class="skeleton h-4 w-24"></div>
      </td>
      <td>
        <div class="skeleton h-4 w-20"></div>
      </td>
      <td>
        <div class="flex gap-2">
          <button class="btn btn-ghost btn-xs" disabled>
            <span class="loading loading-spinner loading-xs"></span>
            Loading...
          </button>
        </div>
      </td>
    <% else %>
      <!-- Loaded state with actual data -->
      <td>
        <div class="font-bold"><%= time_ago_in_words(saved_hong_bao.gifted_at) if saved_hong_bao.gifted_at %> ago</div>
      </td>
      <td>
        <div class="flex items-center gap-3">
          <div class="avatar placeholder">
            <div class="bg-neutral text-neutral-content rounded-full w-12">
              <span class="text-xl"><%= saved_hong_bao.name[0].upcase %></span>
            </div>
          </div>
          <div>
            <div class="font-bold"><%= saved_hong_bao.name %></div>
            <% if saved_hong_bao.notes.present? %>
              <div class="text-sm opacity-50"><%= truncate(saved_hong_bao.notes, length: 50) %></div>
            <% end %>
          </div>
        </div>
      </td>
      <td>
        <div class="font-mono text-xs" title="<%= saved_hong_bao.address %>">
          <%= saved_hong_bao.address.first(8) %>...<%= saved_hong_bao.address.last(6) %>
        </div>
      </td>
      <td>
        <div class="font-bold"><%= number_with_precision(saved_hong_bao.btc, precision: 8) %> BTC</div>
      </td>
      <td>
        <div class="flex items-center gap-3">
          <div class="text-sm opacity-50">$<%= number_with_delimiter(saved_hong_bao.usd.round(2)) %></div>
          <% if show_percentage_change? %>
            <div class="<%= saved_hong_bao.usd_change > 0 ? 'text-success' : 'text-error' %> font-semibold">
              <%= saved_hong_bao.usd_change > 0 ? '↑' : '↓' %>
              <%= saved_hong_bao.balance_change_percentage.abs %>%
            </div>
          <% end %>
        </div>
      </td>
      <td>
        <div class="flex gap-2">
          <%= link_to hong_bao_path(saved_hong_bao.address), class: "btn btn-ghost btn-xs", target: "_blank" do %>
            Details
          <% end %>
          <%= button_to saved_hong_bao, method: :delete,
              data: { turbo_confirm: "Remove #{saved_hong_bao.name}?" },
              class: "btn btn-ghost btn-xs text-error" do %>
            Remove
          <% end %>
        </div>
      </td>
    <% end %>
  </tr>
<% else %>
  <!-- Mobile card view -->
  <div id="saved_hong_bao_card_<%= saved_hong_bao.id %>" class="card bg-base-200 shadow-xl">
    <div class="card-body">
      <% if loading? %>
        <!-- Loading skeleton state -->
        <div class="flex justify-between items-start">
          <h2 class="card-title"><%= saved_hong_bao.name %></h2>
          <div class="skeleton h-6 w-20"></div>
        </div>

        <p class="font-mono text-xs opacity-60">
          <%= saved_hong_bao.address.first(20) %>...
        </p>

        <div class="stats shadow mt-4">
          <div class="stat px-4 py-2">
            <div class="stat-title text-xs">Balance</div>
            <div class="skeleton h-6 w-32"></div>
            <div class="skeleton h-4 w-20 mt-1"></div>
          </div>
        </div>

        <div class="card-actions justify-center mt-4">
          <span class="loading loading-spinner loading-md"></span>
          <span class="text-sm opacity-60">Fetching balance...</span>
        </div>
      <% else %>
        <!-- Loaded state with actual data -->
        <div class="flex justify-between items-start">
          <h2 class="card-title"><%= saved_hong_bao.name %></h2>
          <% status = saved_hong_bao.status %>
          <div class="badge <%= status[:class] %> gap-1">
            <%= heroicon status[:icon], variant: :outline, class: "w-3 h-3" %>
            <%= status[:text] %>
          </div>
        </div>

        <p class="font-mono text-xs opacity-60">
          <%= saved_hong_bao.address.first(20) %>...
        </p>

        <div class="stats shadow mt-4">
          <div class="stat px-4 py-2">
            <div class="stat-title text-xs">Balance</div>
            <div class="stat-value text-lg"><%= number_with_precision(saved_hong_bao.btc, precision: 8) %> BTC</div>
            <div class="stat-desc">$<%= number_with_delimiter(saved_hong_bao.usd.round(2)) %></div>
          </div>
          <% if show_percentage_change? %>
            <div class="stat px-4 py-2">
              <div class="stat-title text-xs">Change</div>
              <div class="stat-value text-lg <%= saved_hong_bao.usd_change > 0 ? 'text-success' : 'text-error' %>">
                <%= saved_hong_bao.usd_change > 0 ? '↑' : '↓' %>
                <%= saved_hong_bao.balance_change_percentage.abs %>%
              </div>
            </div>
          <% end %>
        </div>

        <div class="card-actions justify-end mt-4">
          <%= link_to "View", hong_bao_path(saved_hong_bao.address), class: "btn btn-primary btn-sm", target: "_blank" %>
          <%= button_to "Remove", saved_hong_bao, method: :delete,
              data: { turbo_confirm: "Remove #{saved_hong_bao.name}?" },
              class: "btn btn-error btn-outline btn-sm" %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>