<%# Paper edit component with preview and theme switcher %>
<div id="edit_paper_<%= paper.id %>" class="flex flex-1 flex-col md:flex-row">
  <!-- Paper Preview -->
  <div class="flex-1 bg-base-200 flex items-center justify-center p-4 overflow-hidden">
    <% if processing? %>
      <%# Show processing state with improved messaging %>
      <div class="flex flex-col items-center gap-4">
        <div class="loading loading-spinner loading-lg animate-pulse"></div>
        <div class="text-center">
          <p class="text-base-content font-medium">Creating your unique design</p>
          <p class="text-base-content/60 text-sm mt-1">This typically takes 45-60 seconds</p>
          <p class="text-base-content/50 text-xs mt-3">We're generating your custom AI portrait and composing it onto the template</p>
        </div>
      </div>
    <% elsif image_url %>
      <%# Show paper image %>
      <%= image_tag image_url, class: image_classes, alt: "Paper preview" %>
    <% else %>
      <%# Show placeholder when no image available %>
      <div class="w-96 h-96 bg-base-300 rounded-lg flex items-center justify-center">
        <span class="text-base-content/50">No image available</span>
      </div>
    <% end %>
  </div>

  <!-- Theme Selector (bottom on mobile, right on desktop) -->
  <% unless processing? %>
    <div class="border-t md:border-t-0 md:border-l bg-base-100 md:w-96 animate-in fade-in slide-in-from-bottom-4 duration-500">
      <!-- Success message -->
      <div class="p-4 bg-success/10 border-b border-success/20">
        <div class="flex items-center gap-2 text-success">
          <%= heroicon "sparkles", class: "w-5 h-5" %>
          <p class="text-sm font-medium">Your paper is ready!</p>
        </div>
        <p class="text-xs text-base-content/60 mt-1">You can now choose a different theme or finalize it.</p>
      </div>

      <div class="p-4">
        <h3 class="font-bold hidden text-lg mb-4 md:block">Choose Theme</h3>
        <%= render 'papers/theme_switcher', paper: paper %>
      </div>

      <!-- Actions -->
      <div class="p-4 border-t">
        <div class="flex flex-col gap-2">
          <%= link_to "Finalize Paper", paper_path(paper),
              class: "btn btn-primary w-full",
              data: { turbo: false } %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<%# Subscribe to real-time updates %>
<%= turbo_stream_from paper %>